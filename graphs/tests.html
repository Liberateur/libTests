<!DOCTYPE html>
<html lang="fr">

	<head>
		
		<style type="text/css">

			/* Reset CSS */
			html,body,div,span,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,abbr,address,cite,code,del,dfn,em,img,ins,kbd,q,samp,small,strong,sub,sup,var,b,i,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,figcaption,figure,footer,header,hgroup,menu,nav,section,summary,time,mark,audio,video { margin:0; padding:0; border:0; outline:0; font-size:100%; vertical-align:baseline; background:transparent; }
			body { line-height:1; }
			article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section {  display:block; }
			nav ul { list-style:none; }
			blockquote,q { quotes:none; }
			blockquote:before,blockquote:after,q:before,q:after { content:''; content:none; }
			a { margin:0; padding:0; font-size:100%; vertical-align:baseline; background:transparent; }
			del { text-decoration: line-through; }
			abbr[title],dfn[title] { border-bottom:1px dotted; cursor:help; }
			table { border-collapse:collapse; border-spacing:0; }
			hr { display:block; height:1px; border:0; margin:1em 0; padding:0; }
			input,select { vertical-align:middle; }

			/* Global styles */
			.graph * {
				-webkit-transition:all 200ms ease-out;
				-moz-transition:all 200ms ease-out;
				-ms-transition:all 200ms ease-out;
				-o-transition:all 200ms ease-out;
				transition:all 200ms ease-out
			}
			.graph {
				width: 500px;
				height: 200px;
				margin: 10px auto;
				display: block;
				position: relative;
				border: 5px solid #f9f9f9
			}
			.graph .canvas {
				width: 0;
				overflow: hidden;

				-webkit-transition:all 2s ease-out;
				-moz-transition:all 2s ease-out;
				-ms-transition:all 2s ease-out;
				-o-transition:all 2s ease-out;
				transition:all 2s ease-out
			}
			.graph .bulle {
				position: absolute;
			}
			.graph .bulle b {
				padding: 5px;
				position: absolute;
				margin: -13px 0 0 -13px;
				opacity: 0
			}
			.graph .bulle b i {
				width: 10px;
				height: 10px;
				display: block;
				border-radius: 20px;
				border: 3px solid #fff;
				box-shadow: 0 0 15px rgba(0,0,0,.1);
			}
			.graph .bulle span {
				padding: 5px 10px;
				border-radius: 5px;
				top: -35px;
				left: -50%;
				opacity: 1;
				background: rgba(0,0,0,.2);
				position: relative;
				white-space: nowrap;
				opacity: 0
			}

			.graph.active .canvas { width: 100% }

			.graph .bulle.active b,
			.graph .bulle span.active { opacity: 1 }

		</style>

	</head>

	<body>

		<div class="graph" data-stats="0,40,25,50,60,100,120,80,54" data-color="#eee" data-pcolor="#bbb"></div>
		<!-- <div class="graph" data-stats="10,20,30" data-color="#eee" data-infos="Date,Total" data-linesize="5" data-bezier="false"></div> -->

		<script type="text/javascript">

			// ====================================
			// Objet libgraph
			// ====================================

				// Constructeur
				function libgraph(c)
				{
					this.setBuild(c);
				}

				// Méthodes
				libgraph.prototype =
				{
					// ======================
					// Général settings
					// ======================
					setBuild: function(p)
					{
						// On enregistre le parent
						this.p = p;
						
						// On créer notre canvas
						this.createCanvas();

						// On récupère les paramètres du graph
						var pc  = this.p.getAttribute('data-color'),
							ppc = this.p.getAttribute('data-pcolor'),
							pb  = this.p.getAttribute('data-bezier'),
							pl  = this.p.getAttribute('data-linesize'),
							pi  = this.p.getAttribute('data-statsinfos');

						// Si non défini ou applique les par défauts
						this.pc  = pc  ? pc  : '#999';
						this.ppc = ppc ? ppc : pc;
						this.pi  = pi  ? pi  : '';
						this.pl  = pl  ? parseInt(pl) : 3;
						this.pb  = pb === 'false' ? false : true;

						// On récupère les stats du graph
						this.pos = this.p.getAttribute('data-stats').split(',');
						for(var i in this.pos) this.pos[i] = parseInt(this.pos[i]);

						// On définit la taille du canvas
						this.setSize();

						// On déinfit la liste de coordonnées
						this.setCords();

						// On créer notre graph
						this.createGraph();
					},
					setSize: function()
					{
						// Update width/height this
						this.c.width  = this.p.clientWidth;
						this.c.height = this.p.clientHeight;

						// Update attribut width/size tag canvas css
						this.width  = this.c.width;
						this.height = this.c.height-this.pl*2;
					},
					setCords: function()
					{
						var s = this.width/(this.pos.length-1), c = [], a = 0;

						// On récupère le chiffre le plus haut
						for(var i in this.pos) if(a < this.pos[i]) a = this.pos[i];
						a = a*1.3;

						// On boucle sur les positions et définit les coordonnées x,y
						for(var i in this.pos) c.push([s*i, this.height-this.height*(this.pos[i]*100/a)/100]);

						this.coords = c;
					},


					// ======================
					// Créations
					// ======================
					createCanvas: function()
					{
						// On créer un canvas
						var canvas = document.createElement('canvas'),
							div = document.createElement('div');

						div.className = 'canvas';
						this.c   = canvas;
						this.ctx = canvas.getContext('2d');

						// On reset le parent
						this.p.innerHTML = '';

						// On ajoute le canvas au parent
						div.appendChild(canvas);
						this.p.appendChild(div);
					},
					createBulle: function(n,posx,posy)
					{
						// On créer la bubulle
						var b = document.createElement('div');
						b.className = 'bulle';
						b.style.top = posy+'px';
						b.style.left = posx+'px';
						b.innerHTML = '<b><i style="background:'+this.ppc+'"></i></b><span>'+n+' '+this.pi+'</span>';

						// On ajoute la bubulle
						this.p.appendChild(b);
					},
					createGraph: function()
					{
						// Nouvelle forme
						this.ctx.beginPath();

						// Paramètes
						this.ctx.strokeStyle = this.pc;
						this.ctx.lineWidth   = this.pl;

						// Si bezier est activé
						if(this.pb) var base = this.coords[1][0]/2;

						var last = this.coords[0];

						// Placement du premier point
						this.ctx.moveTo(last[0], last[1]+this.pl);
						this.createBulle(this.pos[0], last[0], last[1]+this.pl);

						// On boucle sur tous les points à partir du deuxième
						for(var i = 1; i < this.coords.length; i++)
						{
							var e = this.coords[i];

							if(!this.pb)
							{
								this.ctx.lineTo(e[0], e[1]);
							}
							else
							{
								this.ctx.bezierCurveTo((last[0]+base), last[1], (e[0]-base), e[1], e[0], e[1]);
								last = e;
							}

							this.createBulle(this.pos[i], e[0], e[1]);
						}

						// On ne fait que le contour
						this.ctx.stroke();

						// On termine la forme
						this.ctx.closePath();
					},

					showCanvas: function()
					{
						var p = this.p, c = p.getElementsByClassName('bulle'), t = c.length;

						// On boucle sur les points et les affiche un puis l'autre
						for(var i in c) showP(c[i],i);
						
						// On lance le tracée
						setTimeout(function() { p.className += ' active'; }, 200*t);
					}
				}

				// Functions
				function showC(c,i) { setTimeout(function(){ c.showCanvas(); }, 250*(i+1)); }
				function showP(c,i) { setTimeout(function(){ c.className += ' active'; }, 200*i); }

			// ====================================
			// Traitement de la page
			// ====================================

				var c = document.getElementsByClassName('graph'), cs = {};

				// On boucle sur tous les .graph
				for(var i = 0; i < c.length; i++)
				{
					// On créer un nouveau graph
					cs[i] = new libgraph(c[i]);

					showC(cs[i],i);
				}

		</script>
		
	</body>

</html>
