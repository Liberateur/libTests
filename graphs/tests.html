<!DOCTYPE html>
<html lang="fr">

	<head>
		
		<style type="text/css">

			/* Reset CSS */
			html, body, body div, span, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, abbr, address, cite, code, del, dfn, em, img, ins, kbd, q, samp, small, strong, sub, sup, var, b, i, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, figure, footer, header, menu, nav, section, time, mark, audio, video, details, summary { margin: 0; padding: 0; border: 0; font-size: 100%; font-weight: normal; vertical-align: baseline; background: transparent; }
			article, aside, figure, footer, header, nav, section, details, summary {display: block;}
			*, *:before, *:after {box-sizing: border-box; }
			img, object, embed {max-width: 100%;}
			html {overflow-y: scroll;}
			ul {list-style: none;}
			blockquote, q {quotes: none;}
			blockquote:before, blockquote:after, q:before, q:after {content: ''; content: none;}
			a {margin: 0; padding: 0; font-size: 100%; vertical-align: baseline; background: transparent;}
			del {text-decoration: line-through;}
			abbr[title], dfn[title] {border-bottom: 1px dotted #000; cursor: help;}
			table {border-collapse: collapse; border-spacing: 0;}
			th {font-weight: bold; vertical-align: bottom;}
			td {font-weight: normal; vertical-align: top;}
			hr {display: block; height: 1px; border: 0; border-top: 1px solid #ccc; margin: 1em 0; padding: 0;}
			input, select {vertical-align: middle;}
			pre { white-space: pre; white-space: pre-wrap; white-space: pre-line; word-wrap: break-word; }
			input[type="radio"] {vertical-align: text-bottom;}
			input[type="checkbox"] {vertical-align: bottom;}
			select, input, textarea {font: 99% sans-serif;}
			table {font-size: inherit; font: 100%;}
			small {font-size: 85%;}
			strong {font-weight: bold;}
			td, td img {vertical-align: top;} 
			sub, sup {font-size: 75%; line-height: 0; position: relative;}
			sup {top: -0.5em;}
			sub {bottom: -0.25em;}
			pre, code, kbd, samp {font-family: monospace, sans-serif;}
			label, input[type=button], input[type=submit], input[type=file], button {cursor: pointer;}
			button, input, select, textarea {margin: 0;}
			button, input[type=button] {width: auto; overflow: visible;}

			/* Fonts */
			@import url(http://fonts.googleapis.com/css?family=Roboto);

			/* Global styles */
			.graph * {
				font-family: 'Roboto', sans-serif;
				-webkit-transition:all 200ms ease-out;
				-moz-transition:all 200ms ease-out;
				-ms-transition:all 200ms ease-out;
				-o-transition:all 200ms ease-out;
				transition:all 200ms ease-out
			}
			.graph {
				width: 500px;
				height: 200px;
				margin: 10px auto;
				display: block;
				position: relative;
				border: 5px solid #f9f9f9;
				font-size: 14px;
			}
			.graph .canvas {
				width: 0;
				overflow: hidden;

				-webkit-transition:all 2s ease-out;
				-moz-transition:all 2s ease-out;
				-ms-transition:all 2s ease-out;
				-o-transition:all 2s ease-out;
				transition:all 2s ease-out
			}

			.graph .infos {
				margin-top: 10px;
				color: #bbb;
				position: relative;
				font-size: 12px
			}
			.graph .infos li { position: absolute; display: block; }
			.graph .infos li span { left: -50%; position: relative; }

			.graph .bulle {
				position: absolute;
			}
			.graph .bulle b {
				padding: 10px;
				position: absolute;
				margin: -17px 0 0 -17px;
				cursor: pointer;
				opacity: 0
			}
			.graph .bulle b i {
				width: 15px;
				height: 15px;
				display: block;
				border-radius: 20px;
				border: 3px solid #fff;
				box-shadow: 0 0 15px rgba(0,0,0,.1);
			}
			.graph .bulle span {
				padding: 3px 5px;
				border-radius: 5px;
				top: -20px;
				left: -50%;
				opacity: 1;
				color: #999;
				background: #fff;
				position: relative;
				white-space: nowrap;
				opacity: 0;
				pointer-events: none;
				box-shadow: 0 0 10px rgba(0,0,0,.1);
			}

			.graph.active .canvas { width: 100% }

			.graph .bulle.active b { opacity: 1 }
			.graph .bulle:hover b i {
				background: #999 !important;
				box-shadow: 0 0 15px rgba(0,0,0,.2)
			}

			.graph .bulle span:hover,
			.graph .bulle b:hover + span {
				pointer-events: auto;
				top: -30px;
				opacity: 1
			}

		</style>

	</head>

	<body>

		<div
			class="graph"
			data-stats="0,40,25,50,60,100,120,80,54"
			data-statsinfos="01/01,02/01,03/01,04/01,05/01,06/01,07/01,08/01,09/01"
			data-infos="Visiteurs"
			data-color="#BBCC00"
		></div>

		<script type="text/javascript">

			// ====================================
			// Objet libgraph
			// ====================================

				// Constructeur
				function libgraph(c)
				{
					this.setBuild(c);
				}

				// Méthodes
				libgraph.prototype =
				{
					// ======================
					// Général settings
					// ======================
					setBuild: function(p)
					{
						// On enregistre le parent
						this.p = p;

						// On récupère les paramètres du graph
						var c = p.getAttribute('data-color'),
							b = p.getAttribute('data-bezier'),
							l = p.getAttribute('data-linesize'),
							i = p.getAttribute('data-infos'),
							o = p.getAttribute('data-opacity'),
							k = p.getAttribute('data-background'),

							psi = p.getAttribute('data-statsinfos').split(','),
							pos = p.getAttribute('data-stats').split(',');

						// On applique les params par défauts
						c = c ? c : '#999';
						i = i ? i : '';
						o = o ? parseInt(o) : 0.4;
						l = l ? parseInt(l) : 3;
						b = b === 'false' ? false : true;
						k = k === 'false' ? false : true;

						// On enregistre les params
						this.params = {bezier: b, sizeLine: l, textInfo: i, color: c, opacity: o, background: k};

						// On récupère les données du graph
						this.coords = { stats: pos, pos: [], posinfos: [] };
						for(var i in pos)
						{
							this.coords.pos.push(parseInt(pos[i]));
							this.coords.posinfos.push(psi[i]);
						}
						
						// On créer notre canvas
						this.createCanvas();
					},
					setSize: function()
					{
						// Update width/height this
						this.c.width  = this.p.clientWidth;
						this.c.height = this.p.clientHeight;

						// Update attribut width/size tag canvas css
						this.width  = this.c.width;
						this.height = this.c.height;

						// On enregistre l'espace entre chaque points
						this.coords.space = this.width/(this.coords.pos.length-1);
					},
					setCords: function()
					{
						var c = [], a = 0;

						// On récupère le chiffre le plus haut
						for(var i in this.coords.pos) if(a < this.coords.pos[i]) a = this.coords.pos[i];
						a = a*1.3;

						// On boucle sur les positions et définit les coordonnées x,y
						for(var i in this.coords.pos) c.push([this.coords.space*i, this.height-this.height*(this.coords.pos[i]*100/a)/100]);

						this.coords.pos = c;
					},


					// ======================
					// Créations
					// ======================
					createCanvas: function()
					{
						// On créer un canvas
						var canvas = document.createElement('canvas'),
							div = document.createElement('div');

						div.className = 'canvas';
						this.c   = canvas;
						this.ctx = canvas.getContext('2d');

						// On reset le parent
						this.p.innerHTML = '';

						// On ajoute le canvas au parent
						div.appendChild(canvas);
						this.p.appendChild(div);

						// On créer une div pour stocker nos infos
						var ul = document.createElement('ul');
						ul.className = 'infos';

						this.p.appendChild(ul);
						this.pinfos = ul;

						// On définit la taille du canvas
						this.setSize();

						// On déinfit la liste de coordonnées
						this.setCords();

						// On créer notre graph
						this.createGraph();
					},
					createBulle: function(n,posx,posy,i)
					{
						// On créer la bubulle
						var b = document.createElement('div');
						b.className  = 'bulle';
						b.style.top  = posy+'px';
						b.style.left = posx+'px';
						b.innerHTML  = '<b><i style="background:'+this.params.color+'"></i></b><span>'+n+' '+this.params.textInfo+'</span>';

						// On ajoute la bubulle
						this.p.appendChild(b);

						// On créer l'infos de la bubulle
						if(this.coords.posinfos[i])
						{
							var b = document.createElement('li');
							b.style.left = posx+'px';
							b.innerHTML  = '<span>'+this.coords.posinfos[i]+'</span>';

							// On ajoute l'infos
							this.pinfos.appendChild(b);
						}
					},
					createGraph: function()
					{
						// Nouvelle forme
						this.ctx.beginPath();

						// Paramètes
						this.ctx.strokeStyle = this.ctx.fillStyle = this.params.color;
						this.ctx.lineWidth   = this.params.sizeLine;

						// Si bezier est activé
						if(this.params.bezier) var base = this.coords.pos[1][0]/2;

						var last = this.coords.pos[0];

						// Placement du premier point
						this.ctx.moveTo(last[0], last[1]);
						this.createBulle(this.coords.stats[0], last[0], last[1], 0);

						// On boucle sur tous les points à partir du deuxième
						for(var i = 1; i < this.coords.pos.length; i++)
						{
							var e = this.coords.pos[i];

							if(!this.params.bezier)
							{
								this.ctx.lineTo(e[0], e[1]);
							}
							else
							{
								this.ctx.bezierCurveTo((last[0]+base), last[1], (e[0]-base), e[1], e[0], e[1]);
								last = e;
							}

							this.createBulle(this.coords.stats[i], e[0], e[1], i);
						}

						// On applique l'opacité
						this.ctx.globalAlpha = this.params.opacity;

						// On trace le contour
						this.ctx.stroke();

						// Si l'on met un background
						if(this.params.background)
						{
							// On ferme le contour pour construire le background
							this.ctx.lineTo(this.width, this.height);
							this.ctx.lineTo(0, this.height);

							// On rempli la forme fermée
							this.ctx.fill();
						}

						// On termine la forme
						this.ctx.closePath();
					},

					showCanvas: function()
					{
						var p = this.p, c = p.getElementsByClassName('bulle');

						// On boucle sur les points et les affiche un puis l'autre
						for(var i in c) showP(c[i],i);
						
						// On lance le tracée
						setTimeout(function() { p.className += ' active'; }, 200*c.length);
					}
				}

				// Functions
				function showP(c,i)
				{
					setTimeout(function(){ c.className += ' active'; }, 200*i);
				}
				function showC(c,i)
				{
					setTimeout(function(){ c.showCanvas(); }, 250*(i+1));

					// On ajoute un mousehover sur les bulles
					hover(c.p);
				}
				function hover(c)
				{
					c.addEventListener('mouseover', function(e)
					{
						e = e || window.event;
						var t = e.srcElement || e.target;

						if(['B','SPAN'].indexOf(t.tagName) != -1) console.log(t.tagName)
					});
				}

			// ====================================
			// Traitement de la page
			// ====================================

				var c = document.getElementsByClassName('graph'), cs = {};

				// On boucle sur tous les .graph
				for(var i = 0; i < c.length; i++)
				{
					// On créer un nouveau graph
					cs[i] = new libgraph(c[i]);

					// On affiche le graph
					showC(cs[i],i);
				}

		</script>
		
	</body>

</html>
